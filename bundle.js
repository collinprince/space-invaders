(()=>{"use strict";var e={366:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createEnemyMissile=void 0;const s=i(507);class a extends s.GameObject{constructor(e,t){super(e.x,e.y,5,5,0,3,n,{isAlive:r}),this.maxY=t}}function n(e){e.fillRect(this.x,this.y,this.width,this.height)}function r(){return this.alive&&this.y<this.maxY}t.createEnemyMissile=(e,t)=>new a(e,t)},520:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createEnemyShip=void 0;const s=i(507);class a extends s.GameObject{constructor(e){super(e.x,e.y,20,20,.5,0,n,{updatePosition:r}),this.internalClock=0}}function n(e){e.strokeStyle="white",e.fillStyle="red",e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x+this.width/2,this.y+this.height),e.lineTo(this.x+this.width,this.y),e.lineTo(this.x+this.width/2,this.y+this.height/4),e.closePath(),e.fill(),e.stroke()}function r(){this.x+=this.dx,this.internalClock+=1,40==this.internalClock&&(this.internalClock=0,this.dx=-this.dx)}t.createEnemyShip=e=>new a(e)},507:(e,t)=>{function i(){return this.alive}function s(){this.x+=this.dx,this.y+=this.dy}Object.defineProperty(t,"__esModule",{value:!0}),t.GameObject=void 0,t.GameObject=class{constructor(e,t,a,n,r,o,h,{updatePosition:l=s,isAlive:d=i}={updatePosition:s,isAlive:i}){this.x=e,this.y=t,this.width=a,this.height=n,this.dx=r,this.dy=o,this.draw=h,this.updatePosition=l,this.isAlive=d,this.alive=!0}setX(e){this.x=e}setY(e){this.y=e}setDx(e){this.dx=e}setDy(e){this.dy=e}setPosition(e,t){this.setX(e),this.setY(t)}setDirection(e,t){this.setDx(e),this.setDy(t)}}},10:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlayerMissile=void 0;const s=i(507),a=i(212),n=i(810);function r(e){let t={x:this.x+this.width/2,y:this.y},i={x:this.x+this.width,y:this.y+this.height},s={x:this.x,y:this.y+this.height};e.fillStyle="blue",(0,a.drawTriangleFill)(e,t,i,s)}function o(){return this.alive&&this.y>0}t.createPlayerMissile=e=>{let t={x:e.x+n.PLAYER_SHIP_WIDTH/2-2.5,y:e.y-10};return new s.GameObject(t.x,t.y,5,10,0,-10,r,{isAlive:o})}},810:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlayerShip=t.PlayerShip=t.STARTING_NUM_LIVES=t.PLAYER_MOVING_SPEED=t.PLAYER_SHIP_HEIGHT=t.PLAYER_SHIP_WIDTH=void 0;const s=i(507);t.PLAYER_SHIP_WIDTH=20,t.PLAYER_SHIP_HEIGHT=30,t.PLAYER_MOVING_SPEED=5,t.STARTING_NUM_LIVES=3;class a extends s.GameObject{constructor(e){super(e.x,e.y,t.PLAYER_SHIP_WIDTH,t.PLAYER_SHIP_HEIGHT,0,0,n,{updatePosition:r,isAlive:o}),this.numLives=t.STARTING_NUM_LIVES}decrementLives(){this.numLives-=1}}function n(e){e.fillStyle="blue",e.beginPath(),e.moveTo(this.x,this.y+this.height),e.lineTo(this.x,this.y+this.height/2),e.lineTo(this.x+this.width/5,this.y+this.height/2),e.lineTo(this.x+this.width/5,this.y+this.height*(5/8)),e.lineTo(this.x+.45*this.width,this.y),e.lineTo(this.x+.55*this.width,this.y),e.lineTo(this.x+.8*this.width,this.y+this.height*(5/8)),e.lineTo(this.x+.8*this.width,this.y+this.height/2),e.lineTo(this.x+this.width,this.y+this.height/2),e.lineTo(this.x+this.width,this.y+this.height),e.lineTo(this.x+.8*this.width,this.y+this.height),e.lineTo(this.x+.8*this.width,this.y+this.height*(7/8)),e.lineTo(this.x+.2*this.width,this.y+this.height*(7/8)),e.lineTo(this.x+.2*this.width,this.y+this.height),e.closePath(),e.fill(),e.stroke()}function r(e,t){this.x+=this.dx,this.x<0&&(this.x=0),this.x+this.width>=e&&(this.x=e-this.width)}function o(){return this.numLives>0}t.PlayerShip=a,t.createPlayerShip=e=>new a(e)},829:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.parseKey=t.Key=void 0,function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Spacebar=2]="Spacebar",e[e.NoOp=3]="NoOp"}(i=t.Key||(t.Key={})),t.parseKey=e=>{return"ArrowLeft"===(t=e.key)||"Left"===t?i.Left:(e=>"ArrowRight"===e||"Right"===e)(e.key)?i.Right:(e=>" "===e||"Spacebar"===e)(e.key)?i.Spacebar:i.NoOp;var t}},142:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateMachine=void 0;const s=i(907),a=i(829),n=i(54),r=i(193),o=i(810),h=i(10),l=i(699),d=i(531),y=new s.State(l.GameMode.Start,(e=>e.keyDown===a.Key.Spacebar?l.GameMode.Play:l.GameMode.Start),(e=>{0===e.world.enemies.length&&(0,n.reset)(e.world,(0,d.getCanvasDimensions)())})),c=new s.State(l.GameMode.Play,(e=>{const{world:t}=e;return 0===t.enemies.length?l.GameMode.Won:0===t.player.numLives?l.GameMode.Lost:l.GameMode.Play}),(e=>{const{keyDown:t,keyUp:i,world:s}=e;if(t===a.Key.Left)s.player.setDx(-o.PLAYER_MOVING_SPEED);else if(e.keyDown===a.Key.Right)s.player.setDx(o.PLAYER_MOVING_SPEED);else if(e.keyDown===a.Key.Spacebar){let e={x:s.player.x,y:s.player.y};s.playerMissiles.push((0,h.createPlayerMissile)(e))}(e.keyUp===a.Key.Left&&s.player.dx<0||e.keyUp===a.Key.Right&&s.player.dx>0)&&s.player.setDx(0)})),m=new s.State(l.GameMode.Won,(e=>e.keyDown===a.Key.Spacebar?l.GameMode.Start:l.GameMode.Won),(e=>{const{world:t}=e;t.playerMissiles=[],t.enemyMissiles=[],t.player.setDx(0)})),p=new s.State(l.GameMode.Lost,(e=>e.keyDown===a.Key.Spacebar?l.GameMode.Start:l.GameMode.Lost),(e=>{const{world:t}=e;t.playerMissiles=[],t.enemies=[],t.enemyMissiles=[],t.player.setDx(0)}));t.stateMachine=new r.StateMachine(l.GameMode.Start,[y,c,m,p])},193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StateMachine=void 0,t.StateMachine=class{constructor(e,t){this.currentState_=e,this.stateMap_=new Map,t.forEach((e=>this.stateMap_.set(e.state(),e)))}transition(e){var t;const i=null===(t=this.stateMap_.get(this.currentState_))||void 0===t?void 0:t.transition(e);return this.currentState_=void 0===i?this.currentState_:i,this.currentState_}behavior(e){var t;null===(t=this.stateMap_.get(this.currentState_))||void 0===t||t.behavior(e)}transitionAndBehavior(e){return this.behavior(e),this.transition(e)}currentState(){return this.currentState_}}},907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0,t.State=class{constructor(e,t,i){this.state_=e,this.transition_=t,this.behavior_=i}state(){return this.state_}transition(e){return this.transition_(e)}behavior(e){this.behavior_(e)}}},699:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.GameMode=void 0,(i=t.GameMode||(t.GameMode={}))[i.Start=0]="Start",i[i.Play=1]="Play",i[i.Won=2]="Won",i[i.Lost=3]="Lost"},796:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectsAreColliding=void 0;const i=(e,t)=>e.start<t.start?e:t,s=(e,t)=>e.start<t.start?t:e;t.objectsAreColliding=(e,t)=>{const a={start:e.x,end:e.x+e.width},n={start:e.y,end:e.y+e.height},r={start:t.x,end:t.x+t.width},o={start:t.y,end:t.y+t.width},h=[i(a,r),s(a,r)],l=[i(n,o),s(n,o)],d=h[0].end>=h[1].start,y=l[0].end>=l[1].start;return d&&y}},531:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCanvasDimensions=t.textHeight=t.textWidth=t.textDimensions=t.writeText=void 0,t.writeText=(e,t,i,s="20px Arial",a="white")=>{e.fillStyle=a,e.font=s,e.fillText(t,i.x,i.y)},t.textDimensions=(e,t,i="20px Arial")=>{e.font=i;const s=e.measureText(t);return{width:Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight),height:Math.abs(s.actualBoundingBoxAscent)+Math.abs(s.actualBoundingBoxDescent)}},t.textWidth=(e,i,s="20px Arial")=>(0,t.textDimensions)(e,i,s).width,t.textHeight=(e,i,s="20px Arial")=>(0,t.textDimensions)(e,i,s).height,t.getCanvasDimensions=()=>{const e=document.getElementById("canvas");return{canvasWidth:e.width,canvasHeight:e.height}}},315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.displayText=void 0;const s=i(699),a=i(531);t.displayText=(e,t,i)=>{const{canvasWidth:n,canvasHeight:r}=i;if(t.gameMode===s.GameMode.Start){const t="SPACE INVADERS",i="Press spacebar to begin.",s=(0,a.textDimensions)(e,t),o=(0,a.textWidth)(e,i),h=10;(0,a.writeText)(e,t,{x:n/2-s.width/2,y:r/2-s.height/2}),(0,a.writeText)(e,i,{x:n/2-o/2,y:r/2+s.height/2+h})}else if(t.gameMode===s.GameMode.Play)(0,a.writeText)(e,`Enemies remaining: ${t.enemies.length}`,{x:10,y:20}),(0,a.writeText)(e,`Lives remaining: ${t.player.numLives}`,{x:10,y:50});else if(t.gameMode===s.GameMode.Won){const t="YOU WON!",i="Press spacebar to play again.",s=(0,a.textDimensions)(e,t),o=(0,a.textWidth)(e,i),h=10;(0,a.writeText)(e,t,{x:n/2-s.width/2,y:r/2-s.height/2}),(0,a.writeText)(e,i,{x:n/2-o/2,y:r/2+s.height/2+h})}else{const t="GAME OVER!",i="Press spacebar to play again.",s=(0,a.textDimensions)(e,t),o=(0,a.textWidth)(e,i),h=10;(0,a.writeText)(e,t,{x:n/2-s.width/2,y:r/2-s.height/2}),(0,a.writeText)(e,i,{x:n/2-o/2,y:r/2+s.height/2+h})}}},212:(e,t)=>{function i(e,t,i,s,a){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(s.x,s.y),e.closePath(),a&&e.fill(),e.stroke()}Object.defineProperty(t,"__esModule",{value:!0}),t.drawCircle=t.drawTriangleOutline=t.drawTriangleFill=void 0,t.drawTriangleFill=(e,t,s,a)=>i(e,t,s,a,!0),t.drawTriangleOutline=(e,t,s,a)=>i(e,t,s,a,!1),t.drawCircle=function(e,t,i){e.beginPath(),e.arc(t.x,t.y,i,0,2*Math.PI),e.stroke()}},54:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gameStateMachineUpdate=t.clearDeadGameObjectsFromWorld=t.detectEnemyMissileAndPlayerShipCollisions=t.detectPlayerMissileAndEnemyShipCollisions=t.randomlyGenerateEnemyMissiles=t.drawAndUpdateWorld=t.reset=t.init=void 0;const s=i(810),a=i(796),n=i(699),r=i(810),o=i(520),h=i(366),l=i(10),d=i(829);t.init=({canvasWidth:e,canvasHeight:t},i)=>{let s={x:e/2-10,y:t-100};return{player:(0,r.createPlayerShip)(s),playerMissiles:new Array,enemies:new Array,enemyMissiles:new Array,maxX:e,maxY:t,gameMode:n.GameMode.Start}},t.reset=(e,t)=>{let i={x:t.canvasWidth/2-10,y:t.canvasHeight-100};e.player.setPosition(i.x,i.y),e.player.numLives=s.STARTING_NUM_LIVES;for(let i=0;i<c;++i){let s={x:20+t.canvasWidth/c*i,y:t.canvasHeight/10};e.enemies.push((0,o.createEnemyShip)(s))}},t.drawAndUpdateWorld=(e,t,i,s)=>{s.gameMode===n.GameMode.Play&&(s.player.draw(e),s.player.updatePosition(t,i),[s.playerMissiles,s.enemies,s.enemyMissiles].forEach((s=>{s.forEach((s=>{s.draw(e),s.updatePosition(t,i)}))})))},t.randomlyGenerateEnemyMissiles=e=>{e.enemies.forEach((t=>{if(Math.random()<.001){let i={x:t.x+t.width/2,y:t.y+t.height};e.enemyMissiles.push((0,h.createEnemyMissile)(i,e.maxY))}}))},t.detectPlayerMissileAndEnemyShipCollisions=e=>{e.enemies.forEach((t=>{e.playerMissiles.forEach((e=>{(0,a.objectsAreColliding)(t,e)&&(t.alive=!1,e.alive=!1)}))}))},t.detectEnemyMissileAndPlayerShipCollisions=e=>{e.enemyMissiles.forEach((t=>{(0,a.objectsAreColliding)(e.player,t)&&(e.player.decrementLives(),t.alive=!1)}))},t.clearDeadGameObjectsFromWorld=e=>{[e.playerMissiles,e.enemies,e.enemyMissiles]=[e.playerMissiles,e.enemies,e.enemyMissiles].map((e=>e.filter((e=>e.isAlive()))))};const y=e=>e.gameMode=n.GameMode.Start,c=10;t.gameStateMachineUpdate=(e,i,a)=>{if(e.gameMode===n.GameMode.Start){if(i.keyDown===d.Key.Spacebar)return(e=>{e.gameMode=n.GameMode.Play})(e),void(0,t.reset)(e,a)}else if(e.gameMode===n.GameMode.Play){if(0===e.enemies.length)return void(e=>{e.gameMode=n.GameMode.Won})(e);if(0===e.player.numLives)return void(e=>{e.gameMode=n.GameMode.Lost})(e);if(i.keyDown===d.Key.Left)e.player.setDx(-s.PLAYER_MOVING_SPEED);else if(i.keyDown===d.Key.Right)e.player.setDx(s.PLAYER_MOVING_SPEED);else if(i.keyDown===d.Key.Spacebar){let t={x:e.player.x,y:e.player.y};e.playerMissiles.push((0,l.createPlayerMissile)(t))}(i.keyUp===d.Key.Left&&e.player.dx<0||i.keyUp===d.Key.Right&&e.player.dx>0)&&e.player.setDx(0)}else e.gameMode===n.GameMode.Won?(e.playerMissiles=[],e.enemyMissiles=[],e.player.setDx(0),i.keyDown===d.Key.Spacebar&&y(e)):e.gameMode===n.GameMode.Lost&&(e.playerMissiles=[],e.enemies=[],e.enemyMissiles=[],e.player.setDx(0),i.keyDown===d.Key.Spacebar&&y(e))}}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}(()=>{const e=i(829),t=i(54),s=i(142),a=i(315),n=document.getElementById("canvas"),r=n.getContext("2d");let o={canvasWidth:n.width,canvasHeight:n.height},h=(0,t.init)(o,10);document.addEventListener("keydown",(t=>{h.gameMode=s.stateMachine.transitionAndBehavior({keyDown:(0,e.parseKey)(t),keyUp:e.Key.NoOp,world:h})})),document.addEventListener("keyup",(t=>{h.gameMode=s.stateMachine.transitionAndBehavior({keyDown:e.Key.NoOp,keyUp:(0,e.parseKey)(t),world:h})})),function i(){const{canvasWidth:n,canvasHeight:l}=o;r.clearRect(0,0,n,l),r.fillStyle="black",r.fillRect(0,0,n,l),h.gameMode=s.stateMachine.transitionAndBehavior({keyDown:e.Key.NoOp,keyUp:e.Key.NoOp,world:h}),(0,a.displayText)(r,h,o),(0,t.randomlyGenerateEnemyMissiles)(h),(0,t.drawAndUpdateWorld)(r,n,l,h),(0,t.detectPlayerMissileAndEnemyShipCollisions)(h),(0,t.detectEnemyMissileAndPlayerShipCollisions)(h),(0,t.clearDeadGameObjectsFromWorld)(h),requestAnimationFrame(i)}()})()})();