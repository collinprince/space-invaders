(()=>{"use strict";var e={366:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createEnemyMissile=void 0;const s=i(507);class n extends s.GameObject{constructor(e,t){super(e.x,e.y,5,5,0,3,a,{isAlive:r}),this.maxY=t}}function a(e){e.fillRect(this.x,this.y,this.width,this.height)}function r(){return this.alive&&this.y<this.maxY}t.createEnemyMissile=(e,t)=>new n(e,t)},520:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAttackingEnemyShip=t.createCirclingEnemyShip=t.createEnemyShip=void 0;const s=i(507),n=i(531);class a extends s.GameObject{constructor(e,t){super(e.x,e.y,20,20,.5,0,r,{updatePosition:t}),this.internalClock=0,this.startPoint=e}}function r(e){e.strokeStyle="white",e.fillStyle="red",e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.x+this.width/2,this.y+this.height),e.lineTo(this.x+this.width,this.y),e.lineTo(this.x+this.width/2,this.y+this.height/4),e.closePath(),e.fill(),e.stroke()}function o(){this.x+=this.dx,this.internalClock+=1,40==this.internalClock&&(this.internalClock=0,this.dx=-this.dx)}t.createEnemyShip=e=>new a(e,o),t.createCirclingEnemyShip=e=>new a(e,l);const h=e=>Math.PI/180*e;function l(){this.x=this.startPoint.x+30*Math.cos(h(this.internalClock)),this.y=this.startPoint.y+30*Math.sin(h(this.internalClock)),this.internalClock=(this.internalClock+1)%360}function c(){this.internalClock+=1,this.internalClock>=500&&(this.y+=2,this.y>(0,n.getCanvasDimensions)().canvasHeight&&(this.y=0-this.height),this.y===this.startPoint.y&&(this.internalClock=0))}t.createAttackingEnemyShip=e=>new a(e,c)},663:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createExplosion=void 0;const s=i(507);t.createExplosion=e=>new n(e);class n extends s.GameObject{constructor(e){super(e.x,e.y,5,5,0,0,a),this.isAlive=()=>this.lifetime_<10,this.lifetime_=0}lifetime(){return this.lifetime_}incrementLifeTime(){++this.lifetime_}}function a(e){this.incrementLifeTime(),e.strokeStyle="yellow",e.beginPath(),[-this.lifetime(),this.lifetime()].forEach((t=>{[-this.lifetime(),this.lifetime()].forEach((i=>{e.moveTo(this.x,this.y),e.lineTo(this.x+t,this.y+i)}))})),e.moveTo(this.x,this.y),e.closePath(),e.stroke()}},507:(e,t)=>{function i(){return this.alive}function s(){this.x+=this.dx,this.y+=this.dy}Object.defineProperty(t,"__esModule",{value:!0}),t.GameObject=void 0,t.GameObject=class{constructor(e,t,n,a,r,o,h,{updatePosition:l=s,isAlive:c=i}={updatePosition:s,isAlive:i}){this.x=e,this.y=t,this.width=n,this.height=a,this.dx=r,this.dy=o,this.draw=h,this.updatePosition=l,this.isAlive=c,this.alive=!0}setX(e){this.x=e}setY(e){this.y=e}setDx(e){this.dx=e}setDy(e){this.dy=e}setPosition(e,t){this.setX(e),this.setY(t)}setDirection(e,t){this.setDx(e),this.setDy(t)}}},10:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlayerMissile=void 0;const s=i(507),n=i(212),a=i(810);function r(e){let t={x:this.x+this.width/2,y:this.y},i={x:this.x+this.width,y:this.y+this.height},s={x:this.x,y:this.y+this.height};e.fillStyle="blue",e.strokeStyle="white",(0,n.drawTriangleFill)(e,t,i,s)}function o(){return this.alive&&this.y>0}t.createPlayerMissile=e=>{let t={x:e.x+a.PLAYER_SHIP_WIDTH/2-2.5,y:e.y-10};return new s.GameObject(t.x,t.y,5,10,0,-10,r,{isAlive:o})}},810:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPlayerShip=t.PlayerShip=t.STARTING_NUM_LIVES=t.PLAYER_MOVING_SPEED=t.PLAYER_SHIP_HEIGHT=t.PLAYER_SHIP_WIDTH=void 0;const s=i(507);t.PLAYER_SHIP_WIDTH=20,t.PLAYER_SHIP_HEIGHT=30,t.PLAYER_MOVING_SPEED=5,t.STARTING_NUM_LIVES=3;class n extends s.GameObject{constructor(e){super(e.x,e.y,t.PLAYER_SHIP_WIDTH,t.PLAYER_SHIP_HEIGHT,0,0,a,{updatePosition:r,isAlive:o}),this.numLives=t.STARTING_NUM_LIVES}decrementLives(){this.numLives-=1}}function a(e){e.fillStyle="blue",e.beginPath(),e.moveTo(this.x,this.y+this.height),e.lineTo(this.x,this.y+this.height/2),e.lineTo(this.x+this.width/5,this.y+this.height/2),e.lineTo(this.x+this.width/5,this.y+this.height*(5/8)),e.lineTo(this.x+.45*this.width,this.y),e.lineTo(this.x+.55*this.width,this.y),e.lineTo(this.x+.8*this.width,this.y+this.height*(5/8)),e.lineTo(this.x+.8*this.width,this.y+this.height/2),e.lineTo(this.x+this.width,this.y+this.height/2),e.lineTo(this.x+this.width,this.y+this.height),e.lineTo(this.x+.8*this.width,this.y+this.height),e.lineTo(this.x+.8*this.width,this.y+this.height*(7/8)),e.lineTo(this.x+.2*this.width,this.y+this.height*(7/8)),e.lineTo(this.x+.2*this.width,this.y+this.height),e.closePath(),e.fill(),e.stroke()}function r(e,t){this.x+=this.dx,this.x<0&&(this.x=0),this.x+this.width>=e&&(this.x=e-this.width)}function o(){return this.numLives>0}t.PlayerShip=n,t.createPlayerShip=e=>new n(e)},371:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createStar=void 0;const s=i(507),n=i(531);t.createStar=e=>new s.GameObject(e.x,e.y,1,1,0,1,(function(e){e.fillStyle="white",e.fillRect(this.x,this.y,this.width,this.height)}),{isAlive:function(){return this.y<(0,n.getCanvasDimensions)().canvasHeight}})},829:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.parseKey=t.Key=void 0,function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Spacebar=2]="Spacebar",e[e.NoOp=3]="NoOp"}(i=t.Key||(t.Key={})),t.parseKey=e=>{return"ArrowLeft"===(t=e.key)||"Left"===t?i.Left:(e=>"ArrowRight"===e||"Right"===e)(e.key)?i.Right:(e=>" "===e||"Spacebar"===e)(e.key)?i.Spacebar:i.NoOp;var t}},91:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasPlayerWon=t.setNextLevel=void 0;const s=i(531),n=i(520),{canvasWidth:a,canvasHeight:r}=(0,s.getCanvasDimensions)(),o=[function(e){for(let t=0;t<10;++t){let i={x:20+a/10*t,y:r/10};e.enemies.push((0,n.createEnemyShip)(i))}},function(e){for(let t=0;t<5;++t){let i={x:20+a/5*t,y:r/10};e.enemies.push((0,n.createEnemyShip)(i))}for(let t=0;t<5;++t){let i={x:30+a/5*t,y:2*r/10};e.enemies.push((0,n.createCirclingEnemyShip)(i))}},function(e){for(let t=0;t<3;++t){let i={x:a/3*t+a/6,y:2*r/10};e.enemies.push((0,n.createEnemyShip)(i))}for(let t=0;t<3;++t){let i={x:a/3*t+a/6,y:2*r/10};e.enemies.push((0,n.createCirclingEnemyShip)(i))}for(let t=0;t<3;++t){let i={x:a/3+t*(a/3/2),y:r/10};e.enemies.push((0,n.createAttackingEnemyShip)(i))}},function(e){for(let t=0;t<20;++t){let i={x:t*a/20+a/20/2,y:r/10};t%2==0?e.enemies.push((0,n.createAttackingEnemyShip)(i)):(i.x-=10,e.enemies.push((0,n.createEnemyShip)(i)))}for(let t=0;t<5;++t){let i={x:t*a/5+a/5/2,y:3*r/10};e.enemies.push((0,n.createCirclingEnemyShip)(i))}},function(e){const t=(0,n.createEnemyShip)({x:0,y:0}),[i,s]=[t.width,t.height],o=3.5*i,l=4*s;for(let t=0;t<5;++t){const i=a/5;let s=t*i;s+=i/2,s-=o/2,h(e,{x:s,y:r/10})}const c=a/10,y=a/10+l+.5*s;for(let t=0;t<2;++t)for(let i=0;i<10;++i){let a={x:i*c+c/2-10,y:y+t*s*1.5};e.enemies.push((0,n.createEnemyShip)(a))}}];t.setNextLevel=e=>{o[e.currentLevel%o.length](e)},t.hasPlayerWon=e=>e.currentLevel+1===o.length;const h=(e,t)=>{let i=t;const s=(0,n.createAttackingEnemyShip)(Object.assign({},i)),[a,r]=[s.width,s.height];e.enemies.push(s),i.x+=2.5*a,e.enemies.push((0,n.createAttackingEnemyShip)(Object.assign({},i))),i.x-=2*a,i.y+=1.5*r,e.enemies.push((0,n.createAttackingEnemyShip)(Object.assign({},i))),i.x+=1.5*a,e.enemies.push((0,n.createAttackingEnemyShip)(Object.assign({},i))),i.x-=.75*a,i.y+=1.5*r,e.enemies.push((0,n.createAttackingEnemyShip)(Object.assign({},i)))}},142:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stateMachine=void 0;const s=i(907),n=i(829),a=i(193),r=i(810),o=i(10),h=i(699),l=i(531),c=i(91),y=new s.State(h.GameMode.Start,(e=>e.keyDown===n.Key.Spacebar?h.GameMode.Play:h.GameMode.Start),(e=>{}),{exitBehavior:e=>{e.world.player.numLives=3,e.world.currentLevel=0}}),d=new s.State(h.GameMode.Play,(e=>{const{world:t}=e;return 0===t.enemies.length?(0,c.hasPlayerWon)(t)?h.GameMode.Won:h.GameMode.BetweenLevels:0===t.player.numLives?h.GameMode.Lost:h.GameMode.Play}),(e=>{const{keyDown:t,keyUp:i,world:s}=e;if(t===n.Key.Left)s.player.setDx(-r.PLAYER_MOVING_SPEED);else if(e.keyDown===n.Key.Right)s.player.setDx(r.PLAYER_MOVING_SPEED);else if(e.keyDown===n.Key.Spacebar){let e={x:s.player.x,y:s.player.y};s.playerMissiles.push((0,o.createPlayerMissile)(e))}(e.keyUp===n.Key.Left&&s.player.dx<0||e.keyUp===n.Key.Right&&s.player.dx>0)&&s.player.setDx(0)}),{enterBehavior:e=>{const{canvasWidth:t,canvasHeight:i}=(0,l.getCanvasDimensions)();let s={x:t/2-10,y:i-100};e.world.player.setPosition(s.x,s.y),(0,c.setNextLevel)(e.world)},exitBehavior:e=>{e.world.enemies=[],e.world.enemyMissiles=[],e.world.playerMissiles=[],e.world.explosions=[],e.world.player.setDx(0)}}),p=new s.State(h.GameMode.Won,(e=>e.keyDown===n.Key.Spacebar?h.GameMode.Start:h.GameMode.Won),(e=>{})),m=new s.State(h.GameMode.Lost,(e=>e.keyDown===n.Key.Spacebar?h.GameMode.Start:h.GameMode.Lost),(e=>{})),x=new s.State(h.GameMode.BetweenLevels,(e=>e.keyDown===n.Key.Spacebar?h.GameMode.Play:h.GameMode.BetweenLevels),(e=>{}),{exitBehavior:e=>{++e.world.currentLevel}});t.stateMachine=new a.StateMachine(h.GameMode.Start,[y,d,p,m,x])},193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StateMachine=void 0,t.StateMachine=class{constructor(e,t){this.currentState_=e,this.stateMap_=new Map,t.forEach((e=>this.stateMap_.set(e.state(),e)))}transition(e){var t;const i=null===(t=this.stateMap_.get(this.currentState_))||void 0===t?void 0:t.transition(e);return this.currentState_=void 0===i?this.currentState_:i,this.currentState_}behavior(e){var t;null===(t=this.stateMap_.get(this.currentState_))||void 0===t||t.behavior(e)}transitionAndBehavior(e){var t;let i=null===(t=this.stateMap_.get(this.currentState_))||void 0===t?void 0:t.transition(e);if(i=void 0===i?this.currentState_:i,i!==this.currentState_){const t=this.stateMap_.get(this.currentState_),s=this.stateMap_.get(i);void 0!==t&&void 0!==s&&(t.exitBehavior(e),s.enterBehavior(e))}else this.behavior(e);return this.currentState_=i,this.currentState_}currentState(){return this.currentState_}}},907:(e,t)=>{function i(){}Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0,t.State=class{constructor(e,t,s,{enterBehavior:n=i,exitBehavior:a=i}={enterBehavior:i,exitBehavior:i}){this.state_=e,this.transition_=t,this.behavior_=s,this.enterBehavior_=n,this.exitBehavior_=a}state(){return this.state_}transition(e){return this.transition_(e)}behavior(e){this.behavior_(e)}enterBehavior(e){this.enterBehavior_(e)}exitBehavior(e){this.exitBehavior_(e)}}},699:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.GameMode=void 0,(i=t.GameMode||(t.GameMode={}))[i.Start=0]="Start",i[i.Play=1]="Play",i[i.Won=2]="Won",i[i.Lost=3]="Lost",i[i.BetweenLevels=4]="BetweenLevels"},796:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectsAreColliding=void 0;const i=(e,t)=>e.start<t.start?e:t,s=(e,t)=>e.start<t.start?t:e;t.objectsAreColliding=(e,t)=>{const n={start:e.x,end:e.x+e.width},a={start:e.y,end:e.y+e.height},r={start:t.x,end:t.x+t.width},o={start:t.y,end:t.y+t.width},h=[i(n,r),s(n,r)],l=[i(a,o),s(a,o)],c=h[0].end>=h[1].start,y=l[0].end>=l[1].start;return c&&y}},531:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCanvasDimensions=t.textHeight=t.textWidth=t.textDimensions=t.writeText=void 0,t.writeText=(e,t,i,s="20px Arial",n="white")=>{e.fillStyle=n,e.font=s,e.fillText(t,i.x,i.y)},t.textDimensions=(e,t,i="20px Arial")=>{e.font=i;const s=e.measureText(t);return{width:Math.abs(s.actualBoundingBoxLeft)+Math.abs(s.actualBoundingBoxRight),height:Math.abs(s.actualBoundingBoxAscent)+Math.abs(s.actualBoundingBoxDescent)}},t.textWidth=(e,i,s="20px Arial")=>(0,t.textDimensions)(e,i,s).width,t.textHeight=(e,i,s="20px Arial")=>(0,t.textDimensions)(e,i,s).height,t.getCanvasDimensions=()=>{const e=document.getElementById("canvas");return{canvasWidth:e.width,canvasHeight:e.height}}},315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.displayText=void 0;const s=i(699),n=i(531),a=(e,t,i)=>{const{canvasWidth:s,canvasHeight:a}=(0,n.getCanvasDimensions)(),r=(0,n.textDimensions)(e,t),o=(0,n.textWidth)(e,i);(0,n.writeText)(e,t,{x:s/2-r.width/2,y:a/2-r.height/2}),(0,n.writeText)(e,i,{x:s/2-o/2,y:a/2+r.height/2+10})};t.displayText=(e,t)=>{t.gameMode===s.GameMode.Start?a(e,"SPACE INVADERS","Press spacebar to begin."):t.gameMode===s.GameMode.Play?((0,n.writeText)(e,`Enemies remaining: ${t.enemies.length}`,{x:10,y:20}),(0,n.writeText)(e,`Lives remaining: ${t.player.numLives}`,{x:10,y:50})):t.gameMode===s.GameMode.BetweenLevels?a(e,"LEVEL BEATEN!","Press spacebar to play next level."):t.gameMode===s.GameMode.Won?a(e,"YOU WON!","Press spacebar to play again."):a(e,"GAME OVER!","Press spacebar to play again.")}},212:(e,t)=>{function i(e,t,i,s,n){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(s.x,s.y),e.closePath(),n&&e.fill(),e.stroke()}Object.defineProperty(t,"__esModule",{value:!0}),t.drawCircle=t.drawTriangleOutline=t.drawTriangleFill=void 0,t.drawTriangleFill=(e,t,s,n)=>i(e,t,s,n,!0),t.drawTriangleOutline=(e,t,s,n)=>i(e,t,s,n,!1),t.drawCircle=function(e,t,i){e.beginPath(),e.arc(t.x,t.y,i,0,2*Math.PI),e.stroke()}},54:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clearDeadGameObjectsFromWorld=t.detectPlayerShipAndEnemyShipCollisions=t.detectEnemyMissileAndPlayerShipCollisions=t.detectPlayerMissileAndEnemyShipCollisions=t.randomlyGenerateStars=t.randomlyGenerateEnemyMissiles=t.drawAndUpdateWorld=t.init=void 0;const s=i(796),n=i(699),a=i(810),r=i(366),o=i(663),h=i(371),l=i(531);t.init=({canvasWidth:e,canvasHeight:t},i)=>{let s={x:e/2-10,y:t-100};return{player:(0,a.createPlayerShip)(s),playerMissiles:new Array,enemies:new Array,enemyMissiles:new Array,stars:new Array,explosions:new Array,maxX:e,maxY:t,gameMode:n.GameMode.Start,currentLevel:0}},t.drawAndUpdateWorld=(e,t,i,s)=>{s.stars.forEach((s=>{s.draw(e),s.updatePosition(t,i)})),s.gameMode===n.GameMode.Play&&(s.player.draw(e),s.player.updatePosition(t,i),[s.playerMissiles,s.enemies,s.enemyMissiles,s.explosions].forEach((s=>{s.forEach((s=>{s.draw(e),s.updatePosition(t,i)}))})))},t.randomlyGenerateEnemyMissiles=e=>{e.enemies.forEach((t=>{if(Math.random()<.001){let i={x:t.x+t.width/2,y:t.y+t.height};e.enemyMissiles.push((0,r.createEnemyMissile)(i,e.maxY))}}))},t.randomlyGenerateStars=e=>{const{canvasWidth:t,canvasHeight:i}=(0,l.getCanvasDimensions)();for(let i=0;i<t;++i)Math.random()<.002&&e.stars.push((0,h.createStar)({x:i,y:0}))},t.detectPlayerMissileAndEnemyShipCollisions=e=>{e.enemies.forEach((t=>{e.playerMissiles.forEach((i=>{(0,s.objectsAreColliding)(t,i)&&(t.alive=!1,i.alive=!1,e.explosions.push((0,o.createExplosion)({x:i.x+i.width/2,y:i.y})))}))}))},t.detectEnemyMissileAndPlayerShipCollisions=e=>{e.enemyMissiles.forEach((t=>{(0,s.objectsAreColliding)(e.player,t)&&(e.player.decrementLives(),t.alive=!1,e.explosions.push((0,o.createExplosion)({x:t.x+t.width/2,y:t.y})))}))},t.detectPlayerShipAndEnemyShipCollisions=e=>{e.enemies.forEach((t=>{(0,s.objectsAreColliding)(e.player,t)&&(e.player.decrementLives(),t.alive=!1,e.explosions.push((0,o.createExplosion)({x:t.x+t.width/2,y:t.y+t.height})))}))},t.clearDeadGameObjectsFromWorld=e=>{[e.playerMissiles,e.enemies,e.enemyMissiles,e.explosions,e.stars]=[e.playerMissiles,e.enemies,e.enemyMissiles,e.explosions,e.stars].map((e=>e.filter((e=>e.isAlive()))))}}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,i),a.exports}(()=>{const e=i(829),t=i(54),s=i(142),n=i(315),a=document.getElementById("canvas"),r=a.getContext("2d");let o={canvasWidth:a.width,canvasHeight:a.height},h=(0,t.init)(o,10);document.addEventListener("keydown",(t=>{h.gameMode=s.stateMachine.transitionAndBehavior({keyDown:(0,e.parseKey)(t),keyUp:e.Key.NoOp,world:h})})),document.addEventListener("keyup",(t=>{h.gameMode=s.stateMachine.transitionAndBehavior({keyDown:e.Key.NoOp,keyUp:(0,e.parseKey)(t),world:h})})),function i(){const{canvasWidth:a,canvasHeight:l}=o;r.clearRect(0,0,a,l),r.fillStyle="black",r.fillRect(0,0,a,l),h.gameMode=s.stateMachine.transitionAndBehavior({keyDown:e.Key.NoOp,keyUp:e.Key.NoOp,world:h}),(0,n.displayText)(r,h),(0,t.randomlyGenerateEnemyMissiles)(h),(0,t.randomlyGenerateStars)(h),(0,t.drawAndUpdateWorld)(r,a,l,h),(0,t.detectPlayerMissileAndEnemyShipCollisions)(h),(0,t.detectEnemyMissileAndPlayerShipCollisions)(h),(0,t.detectPlayerShipAndEnemyShipCollisions)(h),(0,t.clearDeadGameObjectsFromWorld)(h),requestAnimationFrame(i)}()})()})();